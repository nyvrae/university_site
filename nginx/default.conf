server {
    listen 80;
    server_name localhost learning-wildcat-becoming.ngrok-free.app 192.168.1.100 79.170.109.29;

    # Временная страница, пока Next.js приложение не готово
    location / {
        # Если Next.js приложение доступно, проксируем запросы к нему
        if (-f /var/run/app-ready) {
            proxy_pass http://app:3000;
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection 'upgrade';
            proxy_set_header Host $host;
            proxy_cache_bypass $http_upgrade;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
        
        # Если Next.js приложение недоступно, показываем временную страницу
        return 200 '<!DOCTYPE html>
<html>
<head>
    <title>Сайт в процессе развертывания</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 50px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            max-width: 600px;
            margin: 0 auto;
        }
        h1 {
            color: #333;
        }
        p {
            color: #666;
            line-height: 1.6;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Сайт в процессе развертывания</h1>
        <p>Мы работаем над запуском сайта. Пожалуйста, вернитесь позже.</p>
        <p>Домен: learning-wildcat-becoming.ngrok-free.app</p>
    </div>
</body>
</html>';
        add_header Content-Type text/html;
    }
} 